---
//prop of website
import dayjs from "dayjs";
import Chart from "./Chart.astro";
const { website } = Astro.props;
const siteName = new URL(website.url).hostname;
const audit = await import(`../../public/reports/${siteName}/live/report.json`);
const date = dayjs(audit.fetchTime).format("YYYY-MMMM-DD");

// convert audit.categories object to an array
const audits = Object.keys(audit.categories).map((key) => {
    return {
        key,
        ...audit.categories[key],
    };
});

const finalScreenshot = audit.audits['final-screenshot'].details.data;


---

<div class="outline-dotted outline-white p-3 rounded-lg outline-1 text-white">
    <header class="mb-2 flex justify-between align-top items-start">
        <div>
            <h2 class="text-2xl font-extrabold leading-none">{website.name}</h2>
            <a href={website.url} class="text-blue-200">{website.url}</a>
        </div>
        <div class="text-slate-200 text-sm italic">Last fetched on {date}</div>
    </header>
    <div class="grid grid-cols-5 gap-2 items-center justify-center align-center">
        {
            audits.map((audit) => {
                console.log(audit.id);
                return (
                    <div>
                        <Chart key={`${audit.id}-${siteName}`} title={audit.title} value={audit.score} />
                    </div>
                );
            })
        }
        <!-- lets print the audit.audit.final-screenshot -->
         <div class="h-[200px] text-center center justify-center items-center"><img class="h-full inline-block" src={finalScreenshot} /></div>
    </div>
    <div class="text-center mt-4">
        <a href={`/reports/${siteName}/live/report.html`} class="text-blue-200">View full report</a>
    </div>
</div>